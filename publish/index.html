<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HarmonyPlan Blog Manager</title>
  <style>
    /* Base Variables */
    :root {
      --primary-color: #382240;
      --secondary-color: #0066cc;
      --accent-color: #f4f4f4;
      --success-color: #4CAF50;
      --error-color: #f44336;
      --text-color: #333;
      --border-color: #ddd;
    }

    /* Global Resets */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: #f9f9f9;
      padding: 20px;
    }

    /* Header */
    header {
      background: var(--primary-color);
      color: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
    }

    /* Container Layout */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 20px;
    }

    /* Main Content Styles */
    .main-content {
      border-right: 1px solid var(--border-color);
      padding-right: 20px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background: #f1f1f1;
      margin-right: 5px;
      border: 1px solid var(--border-color);
      border-bottom: none;
      border-radius: 5px 5px 0 0;
    }
    .tab.active {
      background: #fff;
      border-bottom: 2px solid var(--secondary-color);
      font-weight: bold;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 16px;
    }
    textarea {
      min-height: 400px;
      resize: vertical;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    /* Buttons */
    button {
      padding: 8px 15px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    button:hover {
      opacity: 0.9;
    }
    button.secondary {
      background: #767676;
      color: #fff;
    }
    button.success {
      background: var(--success-color);
      color: #fff;
    }
    button.error {
      background: var(--error-color);
      color: #fff;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }

    /* Sidebar Styles */
    .sidebar {
      padding-left: 10px;
    }
    .sidebar h3 {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    .posts-list {
      margin-bottom: 20px;
    }
    .year-selector {
      margin-bottom: 10px;
    }
    .month-list,
    .post-list {
      list-style-type: none;
      padding-left: 0;
      margin: 0;
    }
    .month-item {
      padding: 5px 0;
      margin-bottom: 5px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
    }
    .month-item:hover {
      background: #f0f0f0;
    }
    .post-item {
      padding: 5px 0;
      margin-left: 15px;
      cursor: pointer;
    }
    .post-item:hover {
      color: var(--secondary-color);
    }

    /* Status Messages */
    .message {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .message.error {
      background: #ffebee;
      color: var(--error-color);
    }
    .message.success {
      background: #e8f5e9;
      color: var(--success-color);
    }
    .hidden {
      display: none;
    }

    /* Preview Panel */
    .preview-container {
      border: 1px solid var(--border-color);
      padding: 20px;
      margin-top: 20px;
      border-radius: 4px;
      min-height: 400px;
      max-height: 800px;
      overflow: auto;
    }
    .blog-preview h1,
    .blog-preview h2,
    .blog-preview h3 {
      margin-bottom: 15px;
    }
    .blog-preview p {
      margin-bottom: 15px;
    }
    .blog-post-meta {
      color: #666;
      font-style: italic;
      margin-bottom: 20px;
    }
    .blog-social-share {
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
    }
    .blog-social-share a {
      padding: 5px 10px;
      background: #f0f0f0;
      color: #333;
      text-decoration: none;
      border-radius: 3px;
    }

    /* Comments Section */
    .comments-section {
      border-top: 1px solid #ddd;
      margin-top: 30px;
      padding-top: 20px;
    }
    .comment-form input,
    .comment-form textarea {
      margin-bottom: 10px;
    }
    .comments-list {
      margin-top: 20px;
    }
    .comment {
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .comment-author {
      font-weight: bold;
    }
    .comment-date {
      color: #999;
      font-size: 0.9em;
    }

    /* GitHub & Social Settings */
    .github-settings,
    .social-settings {
      padding: 15px;
      background: #f5f5f5;
      border-radius: 4px;
      margin-top: 20px;
    }
    .github-settings h3,
    .social-settings h3 {
      margin-bottom: 10px;
    }

    /* Footer */
    footer {
      margin-top: 50px;
      text-align: center;
      color: #666;
      font-size: 0.9em;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
      .main-content {
        border-right: none;
        padding-right: 0;
      }
      .sidebar {
        padding-left: 0;
        border-top: 1px solid var(--border-color);
        padding-top: 20px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>HarmonyPlan Blog Manager</h1>
    <div>
      <span id="connection-status">Not connected to GitHub</span>
    </div>
  </header>

  <div class="container">
    <div class="main-content">
      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" data-tab="editor">Editor</div>
        <div class="tab" data-tab="preview">Preview</div>
        <div class="tab" data-tab="settings">Settings</div>
      </div>

      <!-- Status Messages -->
      <div id="error-message" class="message error hidden"></div>
      <div id="success-message" class="message success hidden"></div>

      <!-- Editor Tab -->
      <div id="editor-tab" class="tab-content">
        <div class="form-group">
          <label for="post-title">Post Title</label>
          <input type="text" id="post-title" placeholder="Enter post title..." />
        </div>
        <div class="form-group">
          <label for="author-name">Author Name</label>
          <input type="text" id="author-name" value="HarmonyPlan" />
        </div>
        <div class="form-group">
          <label for="html-content">HTML Content</label>
          <textarea id="html-content" placeholder="Paste your HTML content here..."></textarea>
        </div>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="comments-enabled" checked />
          <label for="comments-enabled">Enable comments for this post</label>
        </div>
        <div class="button-group">
          <button id="clear-button" class="secondary">
            <span class="icon">‚úï</span> Clear
          </button>
          <button id="preview-button">
            <span class="icon">üëÅÔ∏è</span> Preview
          </button>
          <button id="publish-button" class="success">
            <span class="icon">üì§</span> Publish
          </button>
        </div>
      </div>

      <!-- Preview Tab -->
      <div id="preview-tab" class="tab-content hidden">
        <div class="preview-container">
          <div id="preview-content" class="blog-preview">
            <!-- Preview will be rendered here -->
          </div>
        </div>
        <div class="button-group">
          <button id="back-to-edit" class="secondary">
            <span class="icon">‚úèÔ∏è</span> Back to Edit
          </button>
          <button id="publish-from-preview" class="success">
            <span class="icon">üì§</span> Publish
          </button>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="settings-tab" class="tab-content hidden">
        <div class="github-settings">
          <h3>GitHub Repository Settings</h3>
          <div class="form-group">
            <label for="github-repo">GitHub Repository</label>
            <input type="text" id="github-repo" value="harmonyca25/blog-posts" />
          </div>
          <div class="form-group">
            <label for="github-token">GitHub Access Token</label>
            <input type="text" id="github-token" placeholder="Enter your GitHub access token" />
            <small>Token will be stored in your browser's local storage.</small>
          </div>
          <button id="connect-github" class="secondary">
            <span class="icon">üîó</span> Connect to GitHub
          </button>
        </div>
        <div class="social-settings">
          <h3>Social Sharing Links</h3>
          <div class="form-group">
            <label for="twitter-link">Twitter</label>
            <input type="text" id="twitter-link" value="https://twitter.com/harmonyplan" />
          </div>
          <div class="form-group">
            <label for="facebook-link">Facebook</label>
            <input type="text" id="facebook-link" value="https://facebook.com/harmonyplan" />
          </div>
          <div class="form-group">
            <label for="linkedin-link">LinkedIn</label>
            <input type="text" id="linkedin-link" value="https://linkedin.com/company/harmonyplan" />
          </div>
          <button id="save-settings" class="success">
            <span class="icon">üíæ</span> Save Settings
          </button>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <h3>Existing Posts</h3>
      <div class="posts-list">
        <div class="form-group year-selector">
          <select id="year-select">
            <option value="2025" selected>2025</option>
            <option value="2024">2024</option>
          </select>
        </div>
        <ul class="month-list" id="month-list">
          <!-- Months and posts are populated dynamically -->
          <li class="month-item" data-month="04">
            April <span class="post-count">(2)</span>
            <ul class="post-list hidden">
              <li class="post-item" data-file="critical-illness-insurance.html">Critical Illness Insurance in Ontario</li>
              <li class="post-item" data-file="market-trends-2025.html">Insurance Market Trends 2025</li>
            </ul>
          </li>
          <li class="month-item" data-month="03">
            March <span class="post-count">(1)</span>
            <ul class="post-list hidden">
              <li class="post-item" data-file="life-insurance-options.html">Understanding Life Insurance Options</li>
            </ul>
          </li>
        </ul>
      </div>
      <div id="firebase-settings">
        <h3>Firebase Settings</h3>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="enable-firebase" checked />
          <label for="enable-firebase">Enable Firebase Comments</label>
        </div>
        <div id="firebase-status">Firebase: Not Connected</div>
      </div>
    </div>
  </div>

  <footer>
    <p>HarmonyPlan Blog Manager ¬© 2025. For internal use only.</p>
  </footer>

  <script>
    // ---------------------------
    // Cache DOM Elements
    // ---------------------------
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const editorTab = document.getElementById('editor-tab');
    const previewTab = document.getElementById('preview-tab');
    const settingsTab = document.getElementById('settings-tab');
    const postTitleInput = document.getElementById('post-title');
    const authorNameInput = document.getElementById('author-name');
    const htmlContentInput = document.getElementById('html-content');
    const commentsEnabledCheckbox = document.getElementById('comments-enabled');
    const previewButton = document.getElementById('preview-button');
    const clearButton = document.getElementById('clear-button');
    const publishButton = document.getElementById('publish-button');
    const publishFromPreviewButton = document.getElementById('publish-from-preview');
    const backToEditButton = document.getElementById('back-to-edit');
    const previewContent = document.getElementById('preview-content');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const monthList = document.getElementById('month-list');
    const yearSelect = document.getElementById('year-select');
    const githubRepoInput = document.getElementById('github-repo');
    const githubTokenInput = document.getElementById('github-token');
    const connectGithubButton = document.getElementById('connect-github');
    const connectionStatus = document.getElementById('connection-status');
    const saveSettingsButton = document.getElementById('save-settings');
    const twitterLinkInput = document.getElementById('twitter-link');
    const facebookLinkInput = document.getElementById('facebook-link');
    const linkedinLinkInput = document.getElementById('linkedin-link');
    const enableFirebaseCheckbox = document.getElementById('enable-firebase');
    const firebaseStatus = document.getElementById('firebase-status');

    // ---------------------------
    // State Variables
    // ---------------------------
    let blogStyles = "";
    let isConnectedToGitHub = false;
    let existingPosts = {};
    let selectedYear = "2025";

    // ---------------------------
    // Utility Functions
    // ---------------------------
    function switchTab(tabName) {
      // Remove active class from all tabs and hide all tab contents
      tabs.forEach(t => t.classList.remove("active"));
      tabContents.forEach(content => content.classList.add("hidden"));
      // Activate selected tab and show corresponding content
      document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add("active");
      document.getElementById(`${tabName}-tab`).classList.remove("hidden");
      if(tabName === "preview") {
        generatePreview();
      }
    }

    function showErrorMessage(msg) {
      errorMessage.textContent = msg;
      errorMessage.classList.remove("hidden");
      setTimeout(() => {
        errorMessage.classList.add("hidden");
      }, 5000);
    }

    function showSuccessMessage(msg) {
      successMessage.textContent = msg;
      successMessage.classList.remove("hidden");
      setTimeout(() => {
        successMessage.classList.add("hidden");
      }, 5000);
    }

    function clearForm() {
      postTitleInput.value = "";
      htmlContentInput.value = "";
    }

    function titleToSlug(title) {
      return title.toLowerCase()
        .replace(/[^\w\s-]/g, "")
        .replace(/\s+/g, "-")
        .replace(/--+/g, "-")
        .trim();
    }

    // ---------------------------
    // Preview Generation
    // ---------------------------
    function generatePreview() {
      const title = postTitleInput.value || "Untitled Post";
      const author = authorNameInput.value || "HarmonyPlan";
      const content = htmlContentInput.value;
      const currentDate = new Date().toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric"
      });

      let previewHTML = `
        <h2>${title}</h2>
        <div class="blog-post-meta">
          By ${author} on ${currentDate}
        </div>
        <div class="blog-post-content">
          ${content}
        </div>
        <div class="blog-social-share">
          <a href="${twitterLinkInput.value}" target="_blank">Share on Twitter</a>
          <a href="${facebookLinkInput.value}" target="_blank">Share on Facebook</a>
          <a href="${linkedinLinkInput.value}" target="_blank">Share on LinkedIn</a>
        </div>
      `;
      if(commentsEnabledCheckbox.checked) {
        previewHTML += `
          <div class="comments-section">
            <h3>Comments</h3>
            <div class="comment-form">
              <input type="text" placeholder="Your name" />
              <textarea placeholder="Your comment"></textarea>
              <button>Submit Comment</button>
            </div>
            <div class="comments-list">
              <div class="comment">
                <div class="comment-author">John Doe</div>
                <div class="comment-date">April 2, 2025</div>
                <div class="comment-content">This is a sample comment.</div>
              </div>
            </div>
          </div>
        `;
      }
      previewContent.innerHTML = previewHTML;
    }

    // ---------------------------
    // Publish Post Functionality
    // ---------------------------
    function publishPost() {
      const title = postTitleInput.value;
      const content = htmlContentInput.value;

      if(!title) {
        showErrorMessage("Please enter a post title");
        return;
      }
      if(!content) {
        showErrorMessage("Please enter post content");
        return;
      }
      if(!isConnectedToGitHub) {
        showErrorMessage("Please connect to GitHub first");
        return;
      }
      
      showSuccessMessage("Post published successfully!");

      // Generate slug and get current year/month for file path
      const slug = titleToSlug(title);
      const now = new Date();
      const year = now.getFullYear().toString();
      const month = (now.getMonth() + 1).toString().padStart(2, "0");

      console.log(`Publishing to GitHub:
        Repository: ${githubRepoInput.value}
        Path: posts/${year}/${month}/${slug}.html
        Title: ${title}
        Author: ${authorNameInput.value}
        Comments Enabled: ${commentsEnabledCheckbox.checked}
      `);

      // Update mock data
      if(!existingPosts[year]) {
        existingPosts[year] = {};
      }
      if(!existingPosts[year][month]) {
        existingPosts[year][month] = [];
      }
      const existingIndex = existingPosts[year][month].findIndex(post => post.title === title || post.file === `${slug}.html`);
      if(existingIndex >= 0) {
        existingPosts[year][month][existingIndex] = { title: title, file: `${slug}.html` };
      } else {
        existingPosts[year][month].push({ title: title, file: `${slug}.html` });
      }
      updatePostsUI();
      clearForm();
    }

    // ---------------------------
    // Update Existing Posts UI
    // ---------------------------
    function updatePostsUI() {
      monthList.innerHTML = "";
      const yearData = existingPosts[selectedYear] || {};
      const monthNames = {
        "01": "January", "02": "February", "03": "March", "04": "April",
        "05": "May", "06": "June", "07": "July", "08": "August",
        "09": "September", "10": "October", "11": "November", "12": "December"
      };
      const sortedMonths = Object.keys(yearData).sort((a, b) => b.localeCompare(a));
      sortedMonths.forEach(month => {
        const posts = yearData[month];
        const monthName = monthNames[month] || `Month ${month}`;
        const monthItem = document.createElement("li");
        monthItem.className = "month-item";
        monthItem.setAttribute("data-month", month);
        monthItem.innerHTML = `${monthName} <span class="post-count">(${posts.length})</span>`;
        const postList = document.createElement("ul");
        postList.className = "post-list hidden";
        posts.forEach(post => {
          const postItem = document.createElement("li");
          postItem.className = "post-item";
          postItem.textContent = post.title;
          postItem.setAttribute("data-file", post.file);
          postItem.addEventListener("click", () => {
            showSuccessMessage(`Loading post: ${post.title}`);
            setTimeout(() => {
              postTitleInput.value = post.title;
              htmlContentInput.value = `<p>This is a placeholder for the content of "${post.title}".</p>
<p>In a real implementation, this would be loaded from GitHub.</p>`;
              switchTab("editor");
            }, 1000);
          });
          postList.appendChild(postItem);
        });
        monthItem.appendChild(postList);
        monthList.appendChild(monthItem);
      });
    }

    // ---------------------------
    // Fetch Blog Styles
    // ---------------------------
    async function fetchBlogStyles() {
      try {
        const response = await fetch("https://harmonyca25.github.io/harmony-ca-redo/css/style.css");
        if(response.ok) {
          blogStyles = await response.text();
          console.log("Blog styles loaded successfully");
        } else {
          console.error("Failed to load blog styles");
        }
      } catch (error) {
        console.error("Error loading blog styles:", error);
      }
    }

    // ---------------------------
    // Load and Save Settings
    // ---------------------------
    function saveSettings() {
      const settings = {
        githubRepo: githubRepoInput.value,
        githubToken: githubTokenInput.value,
        twitterLink: twitterLinkInput.value,
        facebookLink: facebookLinkInput.value,
        linkedinLink: linkedinLinkInput.value,
        enableFirebase: enableFirebaseCheckbox.checked
      };
      localStorage.setItem("blogManagerSettings", JSON.stringify(settings));
    }

    function loadSettings() {
      const settings = JSON.parse(localStorage.getItem("blogManagerSettings"));
      if(settings) {
        githubRepoInput.value = settings.githubRepo || "harmonyca25/blog-posts";
        githubTokenInput.value = settings.githubToken || "";
        twitterLinkInput.value = settings.twitterLink || "https://twitter.com/harmonyplan";
        facebookLinkInput.value = settings.facebookLink || "https://facebook.com/harmonyplan";
        linkedinLinkInput.value = settings.linkedinLink || "https://linkedin.com/company/harmonyplan";
        enableFirebaseCheckbox.checked = settings.enableFirebase !== false;
        if(settings.githubToken) {
          isConnectedToGitHub = true;
          connectionStatus.textContent = `Connected to ${settings.githubRepo}`;
          connectionStatus.style.color = "green";
        }
      }
    }

    // ---------------------------
    // Mock Fetch Posts
    // ---------------------------
    function mockFetchPosts() {
      existingPosts = {
        "2025": {
          "04": [
            { title: "Critical Illness Insurance in Ontario", file: "critical-illness-insurance.html" },
            { title: "Insurance Market Trends 2025", file: "market-trends-2025.html" }
          ],
          "03": [
            { title: "Understanding Life Insurance Options", file: "life-insurance-options.html" }
          ],
          "02": [
            { title: "Financial Planning for Canadians", file: "financial-planning.html" }
          ]
        },
        "2024": {
          "12": [
            { title: "Year-End Insurance Review", file: "year-end-review.html" }
          ],
          "11": [
            { title: "Holiday Insurance Tips", file: "holiday-tips.html" }
          ]
        }
      };
      updatePostsUI();
    }

    // ---------------------------
    // Event Listeners
    // ---------------------------
    // Tab Switching
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        switchTab(tab.getAttribute("data-tab"));
      });
    });

    // Editor Buttons
    previewButton.addEventListener("click", () => {
      switchTab("preview");
    });
    clearButton.addEventListener("click", () => {
      clearForm();
      showSuccessMessage("Form cleared successfully");
    });
    backToEditButton.addEventListener("click", () => {
      switchTab("editor");
    });
    publishButton.addEventListener("click", publishPost);
    publishFromPreviewButton.addEventListener("click", publishPost);

    // Year Select Change
    yearSelect.addEventListener("change", () => {
      selectedYear = yearSelect.value;
      console.log(`Selected year: ${selectedYear}`);
      mockFetchPosts();
    });

    // Month List Toggle
    monthList.addEventListener("click", (e) => {
      const monthItem = e.target.closest(".month-item");
      if(monthItem) {
        const postList = monthItem.querySelector(".post-list");
        postList.classList.toggle("hidden");
      }
    });

    // GitHub Connection
    connectGithubButton.addEventListener("click", () => {
      const repo = githubRepoInput.value;
      const token = githubTokenInput.value;
      if(!repo || !token) {
        showErrorMessage("Please enter both repository name and access token");
        return;
      }
      isConnectedToGitHub = true;
      connectionStatus.textContent = `Connected to ${repo}`;
      connectionStatus.style.color = "green";
      saveSettings();
      showSuccessMessage("Connected to GitHub repository successfully");
    });

    // Save Settings
    saveSettingsButton.addEventListener("click", () => {
      saveSettings();
      showSuccessMessage("Settings saved successfully");
    });

    // ---------------------------
    // Initialization
    // ---------------------------
    document.addEventListener("DOMContentLoaded", () => {
      loadSettings();
      fetchBlogStyles();
      mockFetchPosts();
    });
  </script>
</body>
</html>
